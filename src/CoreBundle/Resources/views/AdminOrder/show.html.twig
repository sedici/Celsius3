{% extends 'Celsius3CoreBundle:Administration:layout.html.twig' %}

{% block title %}
    {{ 'Order View'|trans }}
{% endblock %}

{% block content %}
    {{ parent() }}
    <div ng-app="orderApp" ng-controller="OrderCtrl">
        <div id="cuerpo_pedido" ng-view></div>

        <!-- catalog_search_details.html -->
        <script type="text/ng-template" id="catalog_search_details.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <div class="list-group">
                    <a data-toggle="tooltip" title="{{ 'View order' | trans }}" class="list-group-item" ng-repeat="search in previousSearches(content)" ng-href="{{ {path: 'admin_order_show', params: {'id': search.request.order.id} }|get_url }}">
                        <span class="badge" ng-class="(search.result === 'found') ? 'badge-success' : 'badge-warning'">{{ search.result | trans | first_upper }}</span>
                        <p class="list-group-item-text">{{ search.created_at | date }}</p>
                        <p class="list-group-item-text">
                            <span ng-switch on="order.material_data.volume">
                                <strong ng-switch-when="search.request.order.material_data.volume">
                                    {{ 'volume' | trans }}:
                                    {{ search.request.order.material_data.volume }}
                                </strong>
                                <span ng-switch-default>
                                    {{ 'volume' | trans }}:
                                    {{ search.request.order.material_data.volume }}
                                </span>
                            </span>
                            |
                            <span ng-switch on="order.material_data.year">
                                <strong ng-switch-when="search.request.order.material_data.year">
                                    {{ 'year' | trans }}:
                                    {{ search.request.order.material_data.year }}
                                </strong>
                                <span ng-switch-default>
                                    {{ 'year' | trans }}:
                                    {{ search.request.order.material_data.year }}
                                </span>
                            </span>
                            |
                            <span ng-switch on="order.material_data.start_page">
                                <strong ng-switch-when="search.request.order.material_data.start_page">
                                    {{ 'startPage' | trans }}:
                                    {{ search.request.order.material_data.start_page }}
                                </strong>
                                <span ng-switch-default>
                                    {{ 'startPage' | trans }}:
                                    {{ search.request.order.material_data.start_page }}
                                </span>
                            </span>
                            |
                            <span ng-switch on="order.material_data.end_page">
                                <strong ng-switch-when="search.request.order.material_data.end_page">
                                    {{ 'endPage' | trans }}:
                                    {{ search.request.order.material_data.end_page }}
                                </strong>
                                <span ng-switch-default>
                                    {{ 'endPage' | trans }}:
                                    {{ search.request.order.material_data.end_page }}
                                </span>
                            </span>
                        </p>
                    </a>
                </div>
            {% endverbatim %}
        </script>

        <!-- catalog_list.html -->
        <script type="text/ng-template" id="catalog_list.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <label for="search">{{'search' | trans}}:</label>
                <input type="text" name="search" id="search" ng-change="searchCatalog(catalogSearch)" ng-model="catalogSearch"/>
                <button class="btn btn-sm btn-default pull-right" data-auto-close="1" data-placement="left" bs-popover data-content-template="show_material_data.html?{{assets_version}}" data-container="body">
                    {{ 'orderData' | trans }}
                </button>
                <hr>
                <div id="catalogs-table">
                    <table class="table table-hover catalog-table">
                        <thead>
                            <tr>
                                <th>{{'catalog' | trans}}</th>
                                <th>{{'date' | trans}}</th>
                                <th>{{'result' | trans}}</th>
                                <th>{{'actions' | trans}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="catalog in catalogsWithSearches">
                                <td class="catalog-data">
                                    <p class="{{hasResult(catalog) ? 'lead' : ''}}">
                                        <a ng-href="{{catalog.url}}" target="_blank">{{catalog.name}}</a>
                                    </p>
                                </td>
                                <td class="catalog-result">
                                    {{catalog.search.date|date:'mediumDate'}}
                                </td>
                                <td class="catalog-marker">
                                    <select ng-model="catalog.search.result" ng-options="s.value as s.text for s in search_results" ng-change="updateCatalog(catalog)">
                                        <option value=""></option>
                                    </select>
                                </td>
                                <td class="catalog-actions">
                                    <a href ng-if="catalog.institution && catalog.search" ng-click="requestFromCatalog(catalog)" class="btn btn-default" data-toggle="tooltip" data-placement="bottom" title="{{ 'request' | trans }}">
                                        <span class="glyphicon glyphicon-plus-sign"></span>
                                    </a>
                                    <button
                                        ng-if="hasPreviousSearches(catalog)"
                                        type="button"
                                        class="btn btn-success"
                                        data-auto-close="1"
                                        title="{{'previousSearches'|trans}}"
                                        bs-popover
                                        data-content-template="catalog_search_details.html?{{assets_version}}"
                                        data-content="{{catalog.id}}"
                                        data-container="body"
                                        data-placement="left"
                                        data-toggle="tooltip">
                                        <span class="glyphicon glyphicon-search"></span>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            {% endverbatim %}
        </script>

        <!-- file_list.html -->
        <script type="text/ng-template" id="file_list.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <table class="table table-hover catalog-table">
                    <thead>
                        <tr>
                            <th>{{'name' | trans}}</th>
                            <th>{{'pages' | trans}}</th>
                            <th>{{'state' | trans}}</th>
                            <th>{{'actions' | trans}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="file in files.list">
                            <td>
                                <a ng-href="{{getFileDownloadRoute(file)}}">{{file.name}}</a>
                            </td>
                            <td>{{file.pages}}</td>
                            <td>{{file | state | trans}}</td>
                            <td>
                                <a ng-if="isLocalFile(file)" href ng-click="changeFileState(file)" class="btn">{{'changeState' | trans}}</a>
                            </td>
                        </tr>
                    </tbody>
                </table>
            {% endverbatim %}
        </script>

        <!-- order_cancel_form.html -->
        <script type="text/ng-template" id="order_cancel_form.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <form class="form-horizontal" id="cancelForm" name="formNames.cancel" novalidate ng-submit="cancelRequest()">
                    <div class="form-group" ng-class="cancelerror">
                        <label for="observations">{{'observations' | trans}}</label>
                        <textarea class="form-control" ng-model="forms.cancel.observations" name="observations" id="observations" required></textarea>
                        <label for="cancelledByUser">
                            <input type="checkbox" ng-model="forms.cancel.cancelled_by_user" name="cancelled_by_user">
                            {{ 'cancelledByUser' | trans }}
                        </label>
                    </div>
                </form>
            {% endverbatim %}
        </script>

        <!-- order_email_form.html -->
        <script type="text/ng-template" id="order_email_form.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <form class="form-horizontal" id="emailForm" name="formNames.email" ng-submit="sendEmail()">
                    <div class="form-group" ng-if="contacts !== null">
                        <label for="contact">{{'contact' | trans}}</label>
                        <ui-select ng-model="forms.email.contact" class="form-control" name="contact" id="contact" ng-change="contactChanged()">
                            <ui-select-match allow-clear="{{ select2Contacts.allowClear }}" placeholder="{{ select2Contacts.placeholder }}">
                                <span ng-bind-html="$select.selected.surname + ', ' + $select.selected.name"></span>
                            </ui-select-match>
                            <ui-select-choices repeat="c in (contacts | filter: $select.search) track by c.id">
                                <span ng-bind-html="c.surname + ', ' + c.name + '(' + c.type.name + ')'}}"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <div class="form-group" ng-class="emailerror">
                        <label for="address">{{'address' | trans}}</label>
                        <input type="email" class="form-control" ng-model="forms.email.address" name="address" id="address" required/>
                    </div>
                    <div class="form-group" ng-if="templates.length > 1">
                        <label for="template">{{'template' | trans}}</label>
                        <ui-select ng-model="forms.email.template" name="template" id="email_template_select" ng-change="templateChanged()">
                            <ui-select-match allow-clear="{{ select2Templates.allowClear }}" placeholder="{{ select2Templates.placeholder }}">
                                <span ng-bind="$select.selected.title"></span>
                            </ui-select-match>
                            <ui-select-choices repeat="t in (templates | filter: $select.search) track by t.id">
                                <span ng-bind="t.title"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <div class="form-group" ng-class="subjecterror">
                        <label for="subject">{{'subject' | trans}}</label>
                        <input type="text" class="form-control" ng-model="forms.email.subject" name="subject" id="subject" required/>
                    </div>
                    <div class="form-group" ng-class="texterror">
                        <label for="text">{{'text' | trans }}</label>
                        <textarea id="email_summernote" class="form-control" name="text" id="text" ng-model="forms.email.text" required></textarea>
                        <input type="hidden" name="order_id" id="order_id" ng-model="order.id"/>
                    </div>
                </form>
            {% endverbatim %}
        </script>

        <!-- order_message_form.html -->
        <script type="text/ng-template" id="order_message_form.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <form class="form-horizontal" id="messageForm" name="formNames.message" ng-submit="sendMessage()">

                    <div class="form-group" ng-class="recipientserror">
                        <label for="username">{{'username' | trans}}:{{forms.message.recipients}}</label>

                    </div>
                    <div class="form-group" ng-class="subjecterror">
                        <label for="subject">{{'subject' | trans}}</label>
                        <input type="text" class="form-control" ng-model="forms.message.subject" name="message[subject]" id="message_subject" required/>
                    </div>
                    <div class="form-group" ng-class="bodyerror">
                        <label for="text">{{'text' | trans }}</label>
                        <textarea class="form-control" name="message[body]" id="message_body" ng-model="forms.message.body" required></textarea>
                        <input type="hidden" name="message[recipients]" id="message_recipients" ng-model="forms.message.recipients"/>

                    </div>
                </form>
            {% endverbatim %}
        </script>

        <!-- order_receive_form.html -->
        <script type="text/ng-template" id="order_receive_form.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <form class="form-horizontal" id="receiveForm" name="formNames.receive" novalidate>
                    <div class="form-group" ng-class="delivery_type_error">
                        <label for="delivery_type">{{'deliveryType' | trans}}</label>
                        <ui-select ng-model="forms.receive.delivery_type" name="delivery_type" id="delivery_type" required>
                            <ui-select-match>
                                <span ng-bind="$select.selected | trans"></span>
                            </ui-select-match>
                            <ui-select-choices repeat="dt in (['pdf', 'printed'])">
                                <span ng-bind="dt | trans"></span>
                            </ui-select-choices>
                        </ui-select>
                    </div>
                    <div class="form-group">
                        <label for="observations">{{'observations' | trans}}</label>
                        <textarea class="form-control" ng-model="forms.receive.observations" name="observations" id="observations"></textarea>
                    </div>
                    <div class="form-group" ng-class="files_error">
                        <label for="files">{{'files' | trans}}</label>
                        <button ngf-select ngf-change="addFilesToUpload($files)" ngf-multiple="true">{{ 'addFiles' | trans }}</button>
                        <ul>
                            <li ng-repeat="(key, file) in filesToUpload">{{ file.name }}
                                <a href ng-click="removeFiles(filesToUpload, 'filesToUpload', file)">
                                    <span class="glyphicon glyphicon-remove"></span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </form>
            {% endverbatim %}
        </script>

        <!-- order_reclaim_form.html -->
        <script type="text/ng-template" id="order_reclaim_form.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <form class="form-horizontal" id="reclaimForm" name="formNames.reclaim" novalidate ng-submit="reclaimRequest()">
                    <div class="form-group" ng-class="reclaimerror">
                        <label for="observations">{{'observations' | trans}}</label>
                        <textarea class="form-control" ng-model="forms.reclaim.observations" name="observations" id="observations" required></textarea>
                    </div>
                </form>
            {% endverbatim %}
        </script>

        <!-- order_request_form.html -->
        <script type="text/ng-template" id="order_request_form.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <form class="form-horizontal" id="requestForm" name="formNames.request" ng-submit="submitRequest()">
                    <div class="form-group">
                        <label for="observations">{{'observations' | trans}}</label>
                        <textarea class=" form-control" ng-model="forms.request.observations" name="observations" id="observations"></textarea>
                    </div>
                    <div class="form-group">
                        <label>{{'provider' | trans}}</label>
                        <div class="filter-select" id="filter">
                            <input type="radio" ng-model="forms.request.provider" value="institution" name="provider" id="provider_institution"/>
                            <label for="provider_institution">{{'institution' | trans}}</label>
                            <input type="radio" ng-model="forms.request.provider" value="web" name="provider" id="provider_web"/>
                            <label for="provider_web">{{'web' | trans}}</label>
                            <input type="radio" ng-model="forms.request.provider" value="author" name="provider" id="provider_author"/>
                            <label for="provider_author">{{'author' | trans}}</label>
                        </div>
                    </div>
                    <cci-widget ng-show="forms.request.provider === 'institution'"></cci-widget>
                    <div class="form-group" ng-show="forms.request.provider === 'institution'">
                        <button type="button" ng-click="addInstitutionModal('request-modal')" class="btn btn-default pull-right">{{ 'addInstitution' | trans }}</button>
                    </div>
                </form>
            {% endverbatim %}
        </script>

        <!-- institution_form.html -->
        <script type="text/ng-template" id="institution_form.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <form id="institutionForm" name="formNames.institution" ng-submit="submitInstitution()">
                    <div class="form-group">
                        <label for="name">{{ 'name' | trans }}</label>
                        <input type="text" ng-model="forms.institution.name" name="institution[name]" id="institution_name" class="form-control"/>
                    </div>
                    <div class="form-group">
                        <label for="abbreviation">{{ 'abbreviation' | trans }}</label>
                        <input type="text" ng-model="forms.institution.abbreviation" name="institution[abbreviation]" id="institution_abbreviation" class="form-control"/>
                    </div>
                    <div class="form-group">
                        <label for="website">{{ 'website' | trans }}</label>
                        <input type="text" ng-model="forms.institution.website" name="institution[wbsite]" id="institution_website" placeholder="http://" class="form-control"/>
                    </div>
                    <div class="form-group">
                        <label for="address">{{ 'address' | trans }}</label>
                        <input type="text" ng-model="forms.institution.address" name="institution[address]" id="institution_address" class="form-control"/>
                    </div>
                    <cci-widget id="institution-select"></cci-widget>
                </form>
            {% endverbatim %}
        </script>

        <!-- journal_form.html -->
        <script type="text/ng-template" id="journal_form.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <form id="journalForm" name="formNames.journal" ng-submit="submitJournal()">
                    <div class="form-group">
                        <label for="name">{{ 'name' | trans }}</label>
                        <input type="text" ng-model="forms.journal.name" name="journal[name]" id="journal_name" class="form-control"/>
                    </div>
                    <div class="form-group">
                        <label for="abbreviation">{{ 'abbreviation' | trans }}</label>
                        <input type="text" ng-model="forms.journal.abbreviation" name="journal[abbreviation]" id="journal_abbreviation" class="form-control"/>
                    </div>
                    <div class="form-group">
                        <label for="responsible">{{ 'responsible' | trans }}</label>
                        <input type="text" ng-model="forms.journal.responsible" name="journal[responsible]" id="journal_responsible" class="form-control"/>
                    </div>
                    <div class="form-group">
                        <label for="issn">{{ 'issn' | trans }}</label>
                        <input type="text" ng-model="forms.journal.issn" name="journal[issn]" id="journal_issn" class="form-control"/>
                    </div>
                    <div class="form-group">
                        <label for="issne">{{ 'issne' | trans }}</label>
                        <input type="text" ng-model="forms.journal.issne" name="journal[issne]" id="journal_issne" class="form-control"/>
                    </div>
                    <div class="form-group">
                        <label for="frecuency">{{ 'frecuency' | trans }}</label>
                        <input type="text" ng-model="forms.journal.frecuency" name="journal[frecuency]" id="journal_frecuency" class="form-control"/>
                    </div>
                </form>
            {% endverbatim %}
        </script>

        <!-- order_reupload_form.html -->
        <script type="text/ng-template" id="order_reupload_form.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <form class="form-horizontal" id="reuploadForm">
                    <div class="form-group">
                        <label for="files">{{'files' | trans}}</label>
                        <button ngf-select="" ngf-change="addFilesToReupload($files)" ngf-multiple="true" id="files" name="files">{{ 'addFiles' | trans }}</button>
                        <ul>
                            <li ng-repeat="(key, file) in filesToReupload">{{ file.name }}
                                <a href ng-click="removeFiles(filesToReupload, 'filesToReupload', file)">
                                    <span class="glyphicon glyphicon-remove"></span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </form>
            {% endverbatim %}
        </script>

        <!-- order_upload_form.html -->
        <script type="text/ng-template" id="order_upload_form.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <div class="alert alert-success" ng-if="request.current_state === 'received'">
                    {{'filesSuccessUpload' | trans}}
                </div>
                <div class="alert alert-danger" ng-if="request.current_state === 'taken' && receptions.length > 0">
                    {{'requestReclaimed' | trans}}
                    <ul>
                        <li ng-repeat="reclaim in getReclaims(receptions[0])">{{reclaim.created_at | date:'shortDate'}}
                            -
                            {{reclaim.observations}}</li>
                    </ul>
                </div>
                <form class="form-horizontal" id="uploadForm" ng-if="request.current_state !== 'delivered'">
                    <div class="form-group">
                        <label for="files">{{'files' | trans}}</label>
                        <div class="input-group">
                            <button class="btn btn-default" ngf-select ngf-change="addFilesToUploadBasic($files)" ngf-multiple="true">{{ 'addFiles' | trans }}</button>
                            <button class="btn btn-success" ng-click="submitUpload()">{{'upload' | trans}}</button>
                        </div>
                        <br/>
                        <div>
                            <ul>
                                <li ng-repeat="(key, file) in filesToUploadBasic">{{ file.name }}
                                    <a href ng-click="removeFiles(filesToUploadBasic, 'filesToUploadBasic', file)">
                                        <span class="glyphicon glyphicon-remove"></span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </form>
                <div class="alert alert-success" ng-if="request.current_state === 'delivered'">
                    {{'requestSatisfied' | trans}}
                </div>
            {% endverbatim %}
        </script>

        <!-- request_cancelled.html -->
        <script type="text/ng-template" id="request_cancelled.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <div class="panel2_cancel col-md-1"></div>
                <div class="panel3_cancel col-md-3">
                    <div class="relojito">
                        <span ng-if="request.cancelled" class="glyphicon glyphicon-remove" style="font-size: x-large"></span>
                        <span ng-if="request.annulled" class="glyphicon glyphicon-ban-circle" style="font-size: x-large"></span>
                    </div>
                    <div class="fecha_hoja">{{request.created_at | date:'mediumDate'}}</div>
                </div>
                <div class="panel3_cancel col-md-1 panel3_last_cancel">
                    <ul class="list-unstyled request-actions"></ul>
                </div>
            {% endverbatim %}
        </script>

        <!-- request_not_received.html -->
        <script type="text/ng-template" id="request_not_received.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <div class="panel2 col-md-1"></div>
                <div class="panel3 col-md-3" ng-if="request.type === 'sirequest'">
                    <div class="relojito">
                        <a href ng-click="forms.receive.request = request.id" data-target="#receive-modal" role="button" data-toggle="modal">
                            <span class="glyphicon glyphicon-upload" style="font-size: x-large" data-toggle="tooltip" title="{{ 'upload' | trans }}"></span>
                        </a>
                        <span ng-if="hasReclaim(request)" class="glyphicon glyphicon-warning-sign" style="font-size: x-large"></span>
                    </div>
                    <div class="fecha_relojito" style="vertical-align: middle">
                            <img src="/bundles/celsius3core/images/icon_relojito.png" width="6" height="11" alt="waiting"/>
                            {{request.created_at|date:'mediumDate'}}
                    </div>
                </div>
                <div class="panel3 col-md-3" ng-if="request.type === 'mirequest'">
                    <div class="relojito">
                        <img src="/bundles/celsius3core/images/icon_relojito.png" width="11" height="20" alt="waiting"/>
                        <span ng-if="hasReclaim(request)" class="glyphicon glyphicon-warning-sign" style="font-size: x-large"></span>
                    </div>
                    <div class="fecha_relojito">
                        {{request.created_at|date:'mediumDate'}}
                    </div>
                </div>
                <div class="panel3 col-md-1 panel3_last">
                    <ul class="list-unstyled request-actions">
                        <li>
                            <a href bs-tooltip="cancelTooltip" ng-click="forms.cancel.request = request.id" data-target="#cancel-modal" data-toggle="modal">
                                <span class="glyphicon glyphicon-remove"></span>
                            </a>
                        </li>
                        <li>
                            <a href bs-tooltip="reclaimTooltip" ng-click="forms.reclaim.request = request.id" data-target="#reclaim-modal" data-toggle="modal">
                                <span class="glyphicon glyphicon-repeat"></span>
                            </a>
                        </li>
                        <li ng-if="request.type === 'mirequest'">
                            <a href ng-click="forms.receive.request = request.id" data-target="#receive-modal" role="button" data-toggle="modal">
                                <span class="glyphicon glyphicon-upload" data-toggle="tooltip" title="{{ 'upload' | trans }}"></span>
                            </a>
                        </li>
                    </ul>
                </div>
            {% endverbatim %}
        </script>

        <!-- request_received.html -->
        <script type="text/ng-template" id="request_received.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <div class="panel2_ok col-md-1"></div>
                <div class="panel3_ok col-md-3">
                    <div class="relojito">
                        <span ng-if="!hasApprove(getReceive(request))">
                            <a ng-if="file.enabled" ng-repeat="file in getReceive(request).files.slice(0,3)" ng-href="{{getFileDownloadRoute(file)}}" title="{{file.name}}">
                                <span ng-if="getReceive(request).delivery_type === 'pdf'" class="fa fa-file-pdf-o" style="font-size: large"></span>
                                <span ng-if="getReceive(request).delivery_type === 'printed'" class="fa fa-file-text" style="font-size: large"></span>
                            </a>
                        </span>
                        <span ng-if="hasApprove(getReceive(request))">
                            <a ng-if="file.enabled" ng-repeat="file in getApprove(getReceive(request)).files.slice(0,3)" ng-href="{{getFileDownloadRoute(file)}}" title="{{file.name}}">
                                <span ng-if="getReceive(request).delivery_type === 'pdf'" class="fa fa-file-pdf-o" style="font-size: large"></span>
                                <span ng-if="getReceive(request).delivery_type === 'printed'" class="fa fa-file-text" style="font-size: large"></span>
                            </a>
                        </span>
                        <a href ng-if="!hasApprove(getReceive(request)) && request.type === 'sirequest'" bs-tooltip="viewAllTooltip" ng-click="files.list = getReceive(request).files" data-target="#files-modal" role="button" data-toggle="modal">
                            <span class="glyphicon glyphicon-list-alt" style="font-size: large"></span>
                        </a>
                        <a href ng-if="hasApprove(getReceive(request))" bs-tooltip="viewAllTooltip" ng-click="files.list = getApprove(getReceive(request)).files" data-target="#files-modal" role="button" data-toggle="modal">
                            <span class="glyphicon glyphicon-list-alt" style="font-size: large"></span>
                        </a>
                        <span ng-if="hasReclaim(getReceive(request)) && getReceive(request).reclaimed" class="glyphicon glyphicon-warning-sign" style="font-size: x-large"></span>
                    </div>
                    <div class="fecha_hoja">{{getReceive(request).created_at | date:'mediumDate'}}</div>
                </div>
                <div class="panel3_ok col-md-1 panel3_last_ok">
                    <ul class="list-unstyled request-actions">
                        <li ng-if="request.type === 'mirequest' && !hasApprove(getReceive(request))">
                            <a href bs-tooltip="approveTooltip" ng-click="approve(getReceive(request))">
                                <span class="glyphicon glyphicon-ok"></span>
                            </a>
                        </li>
                        <li ng-if="request.type === 'mirequest' && !hasApprove(getReceive(request))">
                            <a href bs-tooltip="reclaimTooltip" ng-click="forms.reclaim.receive = getReceive(request).id" data-target="#reclaim-modal" data-toggle="modal">
                                <span class="glyphicon glyphicon-repeat"></span>
                            </a>
                        </li>
                        <li ng-if="hasApprove(getReceive(request))">
                            <a href bs-tooltip="reuploadTooltip" ng-click="forms.reupload.receive = getApprove(getReceive(request)).id" data-target="#reupload-modal" role="button" data-toggle="modal">
                                <span class="glyphicon glyphicon-upload"></span>
                            </a>
                        </li>
                        <li ng-if="request.type === 'sirequest'">
                            <a href bs-tooltip="reuploadTooltip" ng-click="forms.reupload.receive = getReceive(request).id" data-target="#reupload-modal" role="button" data-toggle="modal">
                                <span class="glyphicon glyphicon-upload"></span>
                            </a>
                        </li>
                    </ul>
                </div>
            {% endverbatim %}
        </script>

        <!-- show.html -->
        <script type="text/ng-template" id="show.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <div class="item_container row" ng-include="'show_order_data.html?' + assets_version"></div>

                <div class="row">
                    <div class="col-md-9" ng-if="request.type === 'provision' && request.current_state === 'created' && !advanced && searches.length === 0 && !_.isUndefined(request.previous_request)">
                        <div class="row">
                            <div class="col-md-12">
                                <p>{{'provisionModeText' | trans}}</p>
                                <p>
                                    <button class="btn btn-success" ng-click="basicMode()">{{'basic' | trans}}</button>
                                    <button class="btn btn-primary" ng-click="advancedMode()">{{'advanced' | trans}}</button>

                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-9" ng-if="request.type === 'provision' && take.length > 0 && request.current_state === 'taken'">
                        <div class="row">
                            <div class="col-md-12" ng-include="'order_upload_form.html?' + assets_version"></div>
                        </div>
                    </div>

                    <div class="col-md-9" ng-if="request.type === 'search' || advanced || searches.length > 0 || _.isUndefined(request.previous_request)">
                        <div class="alert alert-danger" ng-if="reclaims.length > 0 && (reclaimedRequests().length > 0 || reclaimedReceptions().length > 0)">
                            {{'requestReclaimed' | trans}}
                            <ul>
                                <li ng-repeat="request in reclaimedRequests()">{{getReclaim(request).created_at | date:'shortDate'}}
                                    -
                                    {{getReclaim(request).observations}}</li>
                                <li ng-repeat="reception in reclaimedReceptions()">{{getReclaim(reception).created_at | date:'shortDate'}}
                                    -
                                    {{getReclaim(reception).observations}}</li>
                            </ul>
                        </div>

                        <div class="row">
                            <state-bar></state-bar>
                        </div>

                        <div class="row" ng-include="'show_order_content.html?' + assets_version"></div>
                    </div>

                    <div id="derecha" class="col-md-3" ng-include="'show_order_history.html?'  + assets_version"></div>
                </div>
            {% endverbatim %}
        </script>

        <!-- show_actions.html -->
        <script type="text/ng-template" id="show_actions.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <ul class="list-unstyled">
                    <li>
                        <a ng-href="{{ {path: 'administration'}|get_url}}">
                            <span class="glyphicon glyphicon-home"></span>
                            {{'goToList' | trans}}
                        </a>
                    </li>
                    <li>
                        <a ng-href="{{ {path: 'admin_order_edit', params: {'id': order.id} }|get_url }}">
                            <span class="glyphicon glyphicon-pencil"></span>
                            {{'edit' | trans}}
                        </a>
                    </li>
                    <li>
                        <a href ng-click="changeOperatorModal(order.id)">
                            <span class="glyphicon glyphicon-wrench"></span>
                            {{ 'change_operator' | trans}}
                        </a>
                    </li>
                    <li>
                        <a href ng-click="emailModal(request.owner.email)">
                            <span class="glyphicon glyphicon-envelope"></span>
                            {{'sendMail' | trans}}</a>
                    </li>
                    <li>
                        <!-- <a href ng-click="messageModal(request.owner.username)"><span class="glyphicon glyphicon-envelope"></span> {{'sendMessage' | trans}}</a>
                </li> -->
                    <li ng-if="contains(['received'], request.current_state)">
                        <a href ng-click="deliver()">
                            <span class="glyphicon glyphicon-download"></span>
                            {{'deliver' | trans}}</a>
                    </li>
                    <li ng-if="contains(['created', 'searched'], request.current_state)">
                        <a href ng-click="annul()">
                            <span class="glyphicon glyphicon-ban-circle"></span>
                            {{'annul' | trans}}</a>
                    </li>
                    <li ng-if="contains(['searched', 'requested', 'approval_pending'], request.current_state)">
                        <a href data-target="#cancel-order-modal" data-toggle="modal">
                            <span class="glyphicon glyphicon-remove"></span>
                            {{'cancel' | trans}}</a>
                    </li>
                    <li ng-if="request.current_state !== 'created'">
                        <a href ng-click="undo()">
                            <span class="glyphicon glyphicon-arrow-left"></span>
                            {{'backToPreviousState' | trans}}</a>
                    </li>
                    <li ng-if="request.current_state === 'delivered' && request.owner.pdf === true && !request.has_downloadable_files">
                        <a href ng-click="reenableDownload(request)">
                            <span class="glyphicon glyphicon-download"></span>
                            {{'reenableDownload' | trans}}</a>
                    </li>
                </ul>

                <div id="operator-modal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h3 id="operator-modal-label">{{'change_operator' | trans}}</h3>
                            </div>
                            <div >
                                <table class='table table-bordered' width='70%'>
                                    <tr ng-repeat="a in admins">
                                        <td width="30%">{{a.surname}}
                                            -
                                            {{a.name}}</td>
                                        <td width="40%">
                                            <button class="btn btn-primary" ng-click="selectAdmin(order_id,a.id)">
                                                {{'Asignar' | trans}}</button>

                                        </td>
                                    </tr>
                                </table>
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">{{'close' | trans}}</button>

                            </div>
                        </div>
                    </div>
                </div>

                <div id="cancel-order-modal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h3 id="cancel-modal-label">{{'Cancel'}}</h3>
                            </div>
                            <div class="modal-body" ng-include="'order_cancel_form.html?' + assets_version" ng-bind-html-unsafe="formResponse"></div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">{{'Close'}}</button>
                                <button class="btn btn-primary" ng-click="validateCancelOrder()" value="#cancelForm">{{'Save'}}</button>
                            </div>
                        </div>
                    </div>
                </div>

            {% endverbatim %}

        </script>

        <!-- journal_data.html -->
        <script type="text/ng-template" id="journal_data.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <ul class="list-unstyled">
                    <li class="text-with-ellipsis" ng-if="order.material_data.type === 'journal'">
                        <span ng-if="!_.isUndefined(order.material_data.journal)">
                            <strong>{{'journal' | trans}}</strong>
                            <a ng-href="{{ {path: 'admin_journal_show', params: {'id':order.material_data.journal.id} }|get_url}}">
                                {{order.material_data.journal.name}}
                            </a>
                            <button class="btn btn-default btn-xs action-button" ngclipboard data-clipboard-text="{{order.material_data.journal.name}}" data-toggle="tooltip" data-placement="bottom" title="{{ 'copy' | trans }}">
                                <span class="glyphicon glyphicon-copy"></span>
                            </button>
                        </span>
                        <span ng-if="_.isUndefined(order.material_data.journal)">
                            <strong>{{'journal' | trans}}</strong>
                            {{order.material_data.other}}
                            <button class="btn btn-default btn-xs action-button float2" type="button" role="button" data-toggle="modal" data-placement="bottom" data-target="#journal-modal" title="{{ 'add' | trans }}">
                                <span class="glyphicon glyphicon-plus"></span>
                            </button>
                            <button class="btn btn-default btn-xs action-button" ngclipboard data-clipboard-text="{{order.material_data.other}}" data-toggle="tooltip" data-placement="bottom" title="{{ 'copy' | trans }}">
                                <span class="glyphicon glyphicon-copy"></span>
                            </button>
                        </span>
                    </li>
                    <li ng-if="order.material_data.type === 'journal'">
                        <strong ng-if="!_.isUndefined(order.material_data.journal)">{{'ISSN' | trans}}</strong>
                        {{order.material_data.journal._i_s_s_n}}
                    </li>
                    <li ng-if="order.material_data.type === 'journal'">
                        <strong>{{'volume' | trans}}</strong>
                        {{order.material_data.volume}}
                    </li>
                    <li ng-if="order.material_data.type === 'journal'">
                        <strong>{{'number' | trans}}</strong>
                        {{order.material_data.number}}
                    </li>
                    <li>
                        <strong>{{'year' | trans}}</strong>
                        {{order.material_data.year}}
                    </li>
                    <li class="text-with-ellipsis">
                        <strong>{{'title' | trans}}</strong>
                        {{order.material_data.title}}
                        <button class="btn btn-default btn-xs action-button" ngclipboard data-clipboard-text="{{order.material_data.title}}" data-toggle="tooltip" data-placement="bottom" title="{{ 'copy' | trans }}">
                            <span class="glyphicon glyphicon-copy"></span>
                        </button>
                    </li>
                    <li class="text-with-ellipsis">
                        <strong>{{'authors' | trans}}</strong>
                        {{order.material_data.authors}}
                        <button class="btn btn-default btn-xs action-button" ngclipboard data-clipboard-text="{{order.material_data.authors}}" data-toggle="tooltip" data-placement="bottom" title="{{ 'copy' | trans }}">
                            <span class="glyphicon glyphicon-copy"></span>
                        </button>
                    </li>
                    <li>
                        <strong>{{'startPage' | trans}}</strong>
                        {{order.material_data.start_page}}
                    </li>
                    <li>
                        <strong>{{'endPage' | trans}}</strong>
                        {{order.material_data.end_page}}
                    </li>
                </ul>
            {% endverbatim %}
        </script>

        <!-- book_data.html -->
        <script type="text/ng-template" id="book_data.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <ul class="list-unstyled">
                    <li class="text-with-ellipsis">
                        <strong>{{'title' | trans}}</strong>
                        {{order.material_data.title}}
                        <button class="btn btn-default btn-xs action-button" ngclipboard data-clipboard-text="{{order.material_data.title}}" data-toggle="tooltip" data-placement="bottom" title="{{ 'copy' | trans }}">
                            <span class="glyphicon glyphicon-copy"></span>
                        </button>
                    </li>
                    <li class="text-with-ellipsis">
                        <strong>{{'authors' | trans}}</strong>
                        {{order.material_data.authors}}
                        <button class="btn btn-default btn-xs action-button" ngclipboard data-clipboard-text="{{order.material_data.authors}}" data-toggle="tooltip" data-placement="bottom" title="{{ 'copy' | trans }}">
                            <span class="glyphicon glyphicon-copy"></span>
                        </button>
                    </li>
                    <li ng-if="order.material_data.type === 'book'">
                        <strong>{{'editor' | trans}}</strong>
                        {{order.material_data.editor}}
                    </li>
                    <li>
                        <strong>{{'year' | trans}}</strong>
                        {{order.material_data.year}}
                    </li>
                    <li ng-if="order.material_data.type === 'book' && !order.material_data.with_index">
                        <strong>{{'chapter' | trans}}</strong>
                        {{order.material_data.chapter}}
                    </li>
                    <li ng-if="order.material_data.type === 'book' && order.material_data.with_index">
                        <strong>{{'userRequestsIndex' | trans}}</strong>
                    </li>
                    <li>
                        <strong>{{'startPage' | trans}}</strong>
                        {{order.material_data.start_page}}
                    </li>
                    <li>
                        <strong>{{'endPage' | trans}}</strong>
                        {{order.material_data.end_page}}
                    </li>
                    <li ng-if="order.material_data.type === 'book'">
                        <strong>{{'isbn' | trans}}</strong>
                        {{order.material_data._i_s_b_n}}
                    </li>
                </ul>
            {% endverbatim %}
        </script>

        <!-- newspaper_data.html -->
        <script type="text/ng-template" id="newspaper_data.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <ul class="list-unstyled">
                    <li class="text-with-ellipsis">
                        <strong>{{'title' | trans}}</strong>
                        {{order.material_data.title}}
                        <button class="btn btn-default btn-xs action-button" ngclipboard data-clipboard-text="{{order.material_data.title}}" data-toggle="tooltip" data-placement="bottom" title="{{ 'copy' | trans }}">
                            <span class="glyphicon glyphicon-copy"></span>
                        </button>
                    </li>
                    <li class="text-with-ellipsis">
                        <strong>{{'authors' | trans}}</strong>
                        {{order.material_data.authors}}
                        <button class="btn btn-default btn-xs action-button" ngclipboard data-clipboard-text="{{order.material_data.authors}}" data-toggle="tooltip" data-placement="bottom" title="{{ 'copy' | trans }}">
                            <span class="glyphicon glyphicon-copy"></span>
                        </button>
                    </li>
                    <li ng-if="order.material_data.type === 'newspaper'">
                        <strong>{{'Article' | trans}}</strong>
                        {{order.material_data.article}}
                    </li>
                    <li ng-if="order.material_data.type === 'newspaper'">
                        <strong>{{'Article' | trans}}</strong>
                        {{order.material_data.place}}
                    </li>
                    <li>
                        <strong>{{'date' | trans}}</strong>
                        <span ng-if="order.material_data.month">{{order.material_data.month | trans}} {{order.material_data.day}} {{'of' | trans}}</span> {{order.material_data.year}}
                    </li>
                    <li>
                        <strong>{{'startPage' | trans}}</strong>
                        {{order.material_data.start_page}}
                    </li>
                    <li>
                        <strong>{{'endPage' | trans}}</strong>
                        {{order.material_data.end_page}}
                    </li>
                </ul>
            {% endverbatim %}
        </script>

        <!-- other_data.html -->
        <script type="text/ng-template" id="other_data.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <ul class="list-unstyled">
                    <li class="text-with-ellipsis">
                        <strong>{{'title' | trans}}</strong>
                        {{order.material_data.title}}
                        <button class="btn btn-default btn-xs action-button" ngclipboard data-clipboard-text="{{order.material_data.title}}" data-toggle="tooltip" data-placement="bottom" title="{{ 'copy' | trans }}">
                            <span class="glyphicon glyphicon-copy"></span>
                        </button>
                    </li>
                    <li class="text-with-ellipsis">
                        <strong>{{'authors' | trans}}</strong>
                        {{order.material_data.authors}}
                        <button class="btn btn-default btn-xs action-button" ngclipboard data-clipboard-text="{{order.material_data.authors}}" data-toggle="tooltip" data-placement="bottom" title="{{ 'copy' | trans }}">
                            <span class="glyphicon glyphicon-copy"></span>
                        </button>
                    </li>
                    <li>
                        <strong>{{'year' | trans}}</strong>
                        {{order.material_data.year}}
                    </li>
                    <li>
                        <strong>{{'startPage' | trans}}</strong>
                        {{order.material_data.start_page}}
                    </li>
                    <li>
                        <strong>{{'endPage' | trans}}</strong>
                        {{order.material_data.end_page}}
                    </li>
                    <li ng-if="order.material_data.type === 'congress'">
                        <strong>{{'place' | trans}}</strong>
                        {{order.material_data.place}}
                    </li>
                    <li ng-if="order.material_data.type === 'congress'">
                        <strong>{{'communication' | trans}}</strong>
                        {{order.material_data.communication}}
                    </li>
                    <li ng-if="order.material_data.type === 'thesis'">
                        <strong>{{'director' | trans}}</strong>
                        {{order.material_data.director}}
                    </li>
                    <li ng-if="order.material_data.type === 'thesis'">
                        <strong>{{'degree' | trans}}</strong>
                        {{order.material_data.degree}}
                    </li>
                </ul>
            {% endverbatim %}
        </script>

        <!-- show_material_data.html -->
        <script type="text/ng-template" id="show_material_data.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <h4>{{'itemInformation' | trans}}</h4>
                <div ng-if="order.material_data.type === 'journal'">
                    <div ng-include="'journal_data.html?' + assets_version"></div>
                </div>
                <div ng-if="order.material_data.type === 'book'">
                    <div ng-include="'book_data.html?' + assets_version"></div>
                </div>
                <div ng-if="order.material_data.type === 'newspaper'">
                    <div ng-include="'newspaper_data.html?' + assets_version"></div>
                </div>
                <div ng-if="!(order.material_data.type === 'journal') && !(order.material_data.type === 'book') && !(order.material_data.type === 'newspaper')">
                    <div ng-include="'other_data.html?' + assets_version"></div>
                </div>
            {% endverbatim %}
        </script>

        <!-- show_order_actions.html -->
        <script type="text/ng-template" id="show_order_actions.html?{{ assets_version('admin_order') }}">
            {% verbatim %}

                <div class="explorar_catalogos">
                    <button type="button" class="btn btn-default btn-block" data-target="#search-modal" role="button" data-toggle="modal" id="catalogs_link">
                        <span class="glyphicon glyphicon-search"></span>
                        {{'exploreCatalogs' | trans}}
                    </button>
                </div>

                <div class="explorar_catalogos" ng-if="contains(['searched', 'requested', 'approval_pending', 'received'], request.current_state) && countSearches() > 0">
                    <button type="button" class="btn btn-success btn-block" data-target="#request-modal" role="button" data-toggle="modal">
                        <span class="glyphicon glyphicon-plus"></span>
                        {{'addRequest' | trans}}
                    </button>
                </div>

                <div class="explorar_catalogos" ng-if="contains(['created'], request.current_state)">
                    <button bs-tooltip="requestTooltip" type="button" class="btn btn-default btn-block">
                        <span class="glyphicon glyphicon-plus"></span>
                        {{'addRequest' | trans}}
                    </button>
                </div>

                <div class="explorar_catalogos" ng-if="contains(['requested'], request.current_state) && !currentState(request).search_pending">
                    <button type="button" class="btn btn-default btn-block" role="button" ng-click="pendingSearch()">
                        {{'continueSearch' | trans}}
                    </button>
                </div>

                <div class="explorar_catalogos" ng-if="contains(['requested'], request.current_state) && currentState(request).search_pending">
                    <button type="button" class="btn btn-default btn-block" role="button" ng-click="noPendingSearch()">
                        {{'noContinueSearch' | trans}}
                    </button>
                </div>

                <div id="search-modal" class="modal fade">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 id="search-modal-label" class="modal-title">{{'searchCatalogs' | trans}}</h4>
                            </div>
                            <div class="modal-body" ng-include="'catalog_list.html?' + assets_version"></div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal">{{'close' | trans}}</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="request-modal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h3 id="request-modal-label">{{'request' | trans}}</h3>
                            </div>
                            <div class="modal-body" ng-include="'order_request_form.html?' + assets_version"></div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">{{'close' | trans}}</button>
                                <button class="btn btn-primary" ng-click="validateRequest()" value="#requestForm">{{'save' | trans}}</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="institution-modal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h3 id="institution-modal-label">{{'institution' | trans}}</h3>
                            </div>
                            <div class="modal-body" ng-include="'institution_form.html?' + assets_version"></div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">{{'close' | trans}}</button>
                                <button class="btn btn-primary" ng-click="submitInstitution()" value="#institutionForm">{{'save' | trans}}</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="journal-modal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h3 id="journal-modal-label">{{'journal' | trans}}</h3>
                            </div>
                            <div class="modal-body" ng-include="'journal_form.html?' + assets_version"></div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">{{'close' | trans}}</button>
                                <button class="btn btn-primary" ng-click="submitJournal()" value="#journalForm">{{'save' | trans}}</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="email-modal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h3 id="email-modal-label">{{'email' | trans}}</h3>
                            </div>
                            <div class="modal-body" ng-include="'order_email_form.html?' + assets_version"></div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">{{'close' | trans}}</button>
                                <button class="btn btn-primary" ng-click="validateEmail()" value="#emailForm">{{'send' | trans}}</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="message-modal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h3 id="message-modal-label">{{'message' | trans}}</h3>
                            </div>
                            <div class="modal-body" ng-include="'order_message_form.html?' + assets_version"></div>
                            <div class="modal-footer">
                                <div class="modal-footer">
                                    <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">{{'close' | trans}}</button>
                                    <button class="btn btn-primary" ng-click="validateMessage()" value="#messageForm">{{'send' | trans}}</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endverbatim %}
        </script>

        <!-- show_order_catalog_results.html -->
        <script type="text/ng-template" id="show_order_catalog_results.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <div class="col-md-4">
                    <table class="table table-condensed catalog-result-table" data-type="found">
                        <thead>
                            <tr>
                                <th colspan="3">
                                    <strong style="color:#157C34">{{'found' | trans}}</strong>
                                </th>
                            </tr>
                        </thead>
                        <tbody ui-sortable="sortableOptions" ng-model="filterFound" class="catalogSortable">
                            <tr ng-repeat="catalog in filterFound" data-id="{{catalog.search.id}}">
                                <td></td>
                                <td>{{catalog.name}}</td>
                                <td>{{catalog.search.date|date:'mediumDate'}}</td>
                                <td>
                                    <button ng-click="deleteSearch(catalog)" class="btn btn-link">
                                        <span class="glyphicon glyphicon-remove"></span>
                                    </button>
                                </td>
                            </tr>
                            <tr class="sort-disabled">
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="col-md-4">
                    <table class="table table-condensed catalog-result-table" data-type="partially_found">
                        <thead>
                            <tr>
                                <th colspan="3">
                                    <strong style="color:#157C34">{{'partiallyFound' | trans}}</strong>
                                </th>
                            </tr>
                        </thead>
                        <tbody ui-sortable="sortableOptions" ng-model="filterPartiallyFound" class="catalogSortable">
                            <tr ng-repeat="catalog in filterPartiallyFound" data-id="{{catalog.search.id}}">
                                <td></td>
                                <td>{{catalog.name}}</td>
                                <td>{{catalog.search.date|date:'mediumDate'}}</td>
                                <td>
                                    <button ng-click="deleteSearch(catalog)" class="btn btn-link">
                                        <span class="glyphicon glyphicon-remove"></span>
                                    </button>
                                </td>
                            </tr>
                            <tr class="sort-disabled">
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="col-md-4">
                    <table class="table table-condensed catalog-result-table" data-type="not_found">
                        <thead>
                            <tr>
                                <th colspan="3">
                                    <strong style="color:#E41D19">{{'notFound' | trans}}</strong>
                                </th>
                            </tr>
                        </thead>
                        <tbody ui-sortable="sortableOptions" ng-model="filterNotFound" class="catalogSortable">
                            <tr ng-repeat="catalog in filterNotFound" data-id="{{catalog.search.id}}">
                                <td></td>
                                <td>{{catalog.name}}</td>
                                <td>{{catalog.search.date|date:'mediumDate'}}</td>
                                <td>
                                    <button ng-click="deleteSearch(catalog)" class="btn btn-link">
                                        <span class="glyphicon glyphicon-remove"></span>
                                    </button>
                                </td>
                            </tr>
                            <tr class="sort-disabled">
                                <td></td>
                                <td></td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            {% endverbatim %}
        </script>

        <!-- show_order_content.html -->
        <script type="text/ng-template" id="show_order_content.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <div class="col-md-3" ng-include="'show_order_actions.html?' + assets_version"></div>

                <div id="panel_contenido" class="col-md-9">
                    <div class="row" ng-include="'show_order_request_summary.html?' + assets_version"></div>

                    <div class="panelsecundario row">
                        <h1>{{'searches' | trans}}:
                            {{countSearches()}}</h1>
                        <div ng-include="'show_order_catalog_results.html?' + assets_version" ng-if="countSearches() > 0"></div>
                        <div ng-if="countSearches() === 0">
                            <p>{{'noSearches' | trans}}</p>
                        </div>
                    </div>
                </div>
            {% endverbatim %}
        </script>

        <!-- show_order_data.html -->
        <script type="text/ng-template" id="show_order_data.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <div class="top_info">
                    <div class="top_left">
                        <div ng-class="request.type | request_type">{{request.type | request_type_abbr | trans}}</div>
                        <div class="tipoarticulo">{{order.material_data.type | trans}}</div>
                    </div>

                    <div class="top_right">
                        <div class="status-{{request.current_state}}" data-toggle="tooltip" title="{{request.current_state | trans}}"></div>
                        <div class="uri">{{order.code}}</div>
                        <div class="usuario">
                            {{request.operator ? request.operator.name : '-'}}
                        </div>
                        <div class="decoracion"></div>
                    </div>

                    <div class="top_center pull-right text-center">
                        {{request.created_at|date:'longDate'}}
                    </div>
                </div>

                <div id="pedido_tope" class="row">
                    <div id="columna1" class="col-md-4">
                        <!--<div ng-include="'show_user_information.html?' + assets_version"></div>-->
                        <div ng-include="'show_material_data.html?' + assets_version"></div>
                    </div>

<!--                    <div id="columna2" class="col-md-5" ng-include="'show_interaction.html?' + assets_version"></div>-->

                    <div id="columna3" class="col-md-3" ng-include="'show_actions.html?' + assets_version"></div>
                </div>

                <div class="owner_info">
                    <div class="owner_and_institution">
                        <div class="owner">
                            <a ng-href="{{ {path: 'admin_user_show',params:{'id':request.owner.id} }|get_url}}">{{ request.owner.surname }},
                                {{ request.owner.name }}
                                ({{ request.owner.username }})
                            </a>
                        </div>
                        <div class="institution">{{ printInstitutions(request.owner.institution) }}</div>
                    </div>
                    <div class="user-delivery-type pull-right">
                        <div ng-if="request.owner.pdf === true" class="doc_type_pdf" bs-tooltip="pdfUserTooltip"></div>
                        <div ng-if="request.owner.pdf !== true" class="doc_type_print" bs-tooltip="printedUserTooltip"></div>
                    </div>
                </div>
                <div class="comments" ng-if="request.comments">
                            <h5>{{'comments'|trans}}</h5>
                    <p>{{request.comments}}</p>
                </div>
            {% endverbatim %}
        </script>

        <!-- show_order_history.html -->
        <script type="text/ng-template" id="show_order_history.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <h3>{{ 'history' | trans }}</h3>
                <div ng-if="!groupedEvents">
                    <p>{{ 'noEvents' | trans }}</p>
                </div>
                <div ng-if="!_.isEmpty(groupedEvents)" ng-repeat="(key, value) in groupedEvents">
                    <h2>{{key}}</h2>
                    <div ng-repeat="event in value" ng-if="event.type !== 'creation'  && event.result !== 'not_found'">
                        <a href data-toggle="modal" data-target="#eventModal" data-id="{{event.id}}" ng-click="getEventModalData(event.id)">
                            <span>{{ event.created_at | date:'shortDate' }}</span>
                            <div class="iconhistorial-{{event.type|get_history_icon}}" data-toggle="tooltip" title="{{ event.type | get_state | trans | first_upper }}"></div>
                            <span ng-if="event.type === 'search'">
                                {{ event.result | trans }}
                                {{ 'in' | trans }}
                                {{ event.catalog.name }}
                            </span>
                            <span ng-if="event.type === 'sirequest' || event.type === 'mirequest'">
                                <span ng-if="event.provider.type === 'institution'">{{ 'requested to' | trans }}</span>
                                {{ event.provider.provider_name }}
                            </span>
                            <span>
                                {{ 'by' | trans }}
                                {{ event.operator.name }}
                                <span ng-if="event.type === 'cancel' && event.cancelled_by_user">{{ 'byUserRequest' | trans }}</span>
                            </span>
                            <span ng-if="event.observations.length > 0" class="glyphicon glyphicon-comment" aria-hidden="true">

                            </span>
                            <br>
                            <br>
                        </a>
                    </div>
                </div>

                <!-- Event modal -->
                <div class="modal fade" id="eventModal" tabindex="-1" role="dialog">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title">{{ 'event information' | trans }}</h4>
                      </div>
                      <div class="modal-body">
                        <dl class="dl-horizontal">
                            <dt>{{ 'event type' | trans }}</dt>
                            <dd>{{ eventModalData.type | trans }}</dd>

                            <dt>{{ 'date' | trans }}</dt>
                            <dd>{{ eventModalData.createdAt | date }}</dd>

                            <dt>{{ 'operator' | trans }}</dt>
                            <dd>{{ eventModalData.operator.surname }}, {{ eventModalData.operator.name }}</dd>

                            <dt ng-if="eventModalData.type === 'search'">{{ 'result' | trans }}</dt>
                            <dd ng-if="eventModalData.type === 'search'">{{ eventModalData.result | trans }}</dd>
                            <dt ng-if="eventModalData.type === 'search'">{{ 'catalog' | trans }}</dt>
                            <dd ng-if="eventModalData.type === 'search'">{{ eventModalData.catalog.name }}</dd>

                            <dt ng-if="eventModalData.type === 'sirequest' || eventModalData.type === 'mirequest'">{{ 'requested to' | trans  }}</dt>
                            <dt ng-if="eventModalData.type === 'reclaim'">{{ 'reclaimed to' | trans  }}</dt>
                            <dd ng-if="eventModalData.type === 'sirequest' || eventModalData.type === 'mirequest' || eventModalData.type === 'reclaim'">
                                {{ eventModalData.request_event.provider.name }}
                            </dd>
                            <dt>{{ 'observations' | trans }}</dt>
                            <dd>
                                <p id="observationsText" ng-if="!_.isEmpty(eventModalData.observations)">{{ eventModalData.observations }}</p>
                                <a href ng-click="addObservations()">{{ 'Add observations' | trans }}</a>

                                <form id="editObservations" class="hidden">
                                    <textarea cols="40" rows="8" ng-model="eventModalData.temporalObservations"></textarea>
                                    <button ng-click="updateObservations()" class="btn btn-success">{{ 'save' | trans }}</button>
                                </form>

                            </dd>
                        </dl>
                      </div>
                    </div>
                  </div>
                </div>
            {% endverbatim %}
        </script>

        <!-- show_order_request_summary.html -->
        <script type="text/ng-template" id="show_order_request_summary.html?{{ assets_version('admin_order') }}">
            {% verbatim %}
                <h1>{{'requests' | trans}}</h1>
                <div class="no-requests" ng-if="requests.length === 0">
                    {{'noRequests' | trans}}
                </div>
                <div ng-if="requests.length > 0">
                    <div ng-repeat="request in requests" class="item1 col-md-12">
                        <div class="panel1 col-md-7">
                            <div class="cat_datos">
                                <div class="cat_estrella"></div>
                                <div class="cat_titulo" ng-if="request.provider.type == 'institution'">{{ printInstitutions(request.provider) }}</div>
                                <div class="" ng-if="request.provider.type == 'author'">{{ 'providedByTheAuthor' | trans }}</div>
                                <div class="cat_titulo" ng-if="request.provider.type == 'web'">{{ 'foundOnTheWeb' | trans }}</div>
                                <div class="cat_fecha"></div>
                            </div>
                        </div>
                        <div ng-if="!hasReceive(request) && !request.cancelled && !request.annulled" ng-include="'request_not_received.html?' + assets_version"></div>
                        <div ng-if="hasReceive(request) && !request.cancelled  && !request.annulled" ng-include="'request_received.html?' + assets_version"></div>
                        <div ng-if="request.cancelled || request.annulled" ng-include="'request_cancelled.html?' + assets_version"></div>
                    </div>
                </div>

                <div id="receive-modal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h3 id="request-modal-label">{{'receive' | trans}}:
                                    {{order.code}}</h3>
                            </div>
                            <div class="modal-body" ng-include="'order_receive_form.html?' + assets_version"></div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">{{'close' | trans}}</button>
                                <button class="btn btn-primary" ng-click="submitReceive()" value="#receiveForm">{{'save' | trans}}</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="reupload-modal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h3 id="reupload-modal-label">{{'uploadAgain' | trans}}</h3>
                            </div>
                            <div class="modal-body" ng-include="'order_reupload_form.html?' + assets_version"></div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">{{'close' | trans}}</button>
                                <button class="btn btn-primary" ng-click="submitReupload()" value="#reuploadForm">{{'save' | trans}}</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="cancel-modal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h3 id="cancel-modal-label">{{'cancel' | trans}}</h3>
                            </div>
                            <div class="modal-body" ng-include="'order_cancel_form.html?' + assets_version"></div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">{{'close' | trans}}</button>
                                <button class="btn btn-primary" ng-click="validateCancel()" value="#cancelForm">{{'save' | trans}}</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="reclaim-modal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h3 id="reclaim-modal-label">{{'reclaim' | trans}}</h3>
                            </div>
                            <div class="modal-body" ng-include="'order_reclaim_form.html?' + assets_version"></div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">{{'close' | trans}}</button>
                                <button class="btn btn-primary" ng-click="validateReclaim()" value="#cancelForm">{{'save' | trans}}</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="files-modal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h3 id="files-modal-label">{{'uploadedFiles' | trans}}</h3>
                            </div>
                            <div class="modal-body" ng-include="'file_list.html?' + assets_version"></div>
                            <div class="modal-footer">
                                <button class="btn btn-default" data-dismiss="modal" aria-hidden="true">{{'close' | trans}}</button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endverbatim %}
        </script>

        {% include 'Celsius3CoreBundle:CCI:cci.html.twig' %}
        {% include 'Celsius3CoreBundle:StateBar:state_bar.html.twig' %}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript">
        var request_id = {{ entity.code }};
    </script>
    <script type="text/javascript" src="{{ asset('build/angular.js') }}"></script>
    <script type="text/javascript" src="{{ asset('build/cci.js') }}"></script>
    <script type="text/javascript" src="{{ asset('build/state_bar.js') }}"></script>
    <script type="text/javascript" src="{{ asset('build/admin_order.js') }}"></script>
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <style type="text/css">
        .popover {
            width: auto !important;
            max-width: 600px !important;
            height: auto !important;
            max-height: 400px !important;
        }

        .popover-content {
            width: auto !important;
            max-width: 500px !important;
            height: auto !important;
            max-height: 300px !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
        }

    </style>
{% endblock %}
